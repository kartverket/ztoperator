apiVersion: skiperator.kartverket.no/v1alpha1
kind: Application
metadata:
  name: application
spec:
  podSettings:
    annotations:
      sidecar.istio.io/logLevel: 'debug'
      sidecar.istio.io/userVolume: '[
        {
          "name": "secret",
          "secret": {
            "secretName": "auth-policy-envoy-secret"
          }
        },
        {
          "name": "lua",
          "configMap": {
            "name": "auth-policy-lua-script"
          }
        }        
      ]'
      sidecar.istio.io/userVolumeMount: '[
        {
          "name": "secret",
          "mountPath": "/etc/istio/config",
          "readonly": true
        },
        {
          "name": "lua",
          "mountPath": "/etc/envoy/lua",
          "readonly": true
        }        
      ]'
  image: hashicorp/http-echo:latest
  port: 5678
  replicas: 1
  ingresses:
    - foo.bar
  accessPolicy:
    outbound:
      rules:
        - application: mock-oauth2
          namespace: auth